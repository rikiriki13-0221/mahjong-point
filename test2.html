<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>麻雀点数記録アプリ</title>
  <style>
    body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  padding: 1em;
  background: #f2f2f2;
}

h1 {
  text-align: center;
  font-size: 1.8em;
  font-weight: bold;
  margin-bottom: 1em;
}

button {
  font-size: 1em;
  padding: 0.5em 1.2em;
  border: 2px solid #2196f3;
  background: #fff;
  color: #2196f3;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}
    
#players {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 1em;
  margin-bottom: 2em;
}

.player {
  background: #fff;
  padding: 1em;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  text-align: center;
}

.player input[type="text"] {
  width: 90%;
  padding: 0.4em;
  font-size: 1em;
  margin-bottom: 0.5em;
  text-align: center;
}

.player p {
  font-size: 2em;
  margin: 0.3em 0;
  font-weight: bold;
}

.score-controls button {
  margin: 0.2em;
}

.supply {
  margin: 2em 0 1em;
  text-align: center;
  font-size: 1.1em;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
  background: #fff;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

table, th, td {
  border: 1px solid #ccc;
}

th, td {
  padding: 0.6em;
  text-align: center;
}

.log-table {
  margin-top: 2em;
  overflow-x: auto;
  display: block;
  white-space: nowrap;
}

.log-table td:first-child {
  font-weight: bold;
  background: #f1f1f1;
}

.clickable {
  cursor: pointer;
  color: #1976d2;
  text-decoration: underline;
}

@media screen and (max-width: 600px) {
  #players {
    grid-template-columns: 1fr 1fr;
  }
}

  </style>
</head>
<body>
  <h1>麻雀点数記録アプリ</h1>

  <div id="players"></div>

  <div class="supply">
    <p>供託点: <span id="supply">0</span></p>
    <button onclick="addSupply()">+1000</button>
    <button onclick="subSupply()">-1000</button>
  </div>

  <button onclick="recordLog()">記録する</button>
  <button onclick="resetScores()">点数リセット</button>

  <table id="log" class="log-table">
    <tbody></tbody>
  </table>

 <script>
    const playerCount = 4;
    const players = [];
    const logData = [];
    const defaultNames = [];
    for (let i = 0; i < playerCount; i++) {
      defaultNames.push(`プレイヤー${i + 1}`);
    }

    const playerContainer = document.getElementById('players');
    for (let i = 0; i < playerCount; i++) {
      const playerDiv = document.createElement('div');
      playerDiv.className = 'player';
      playerDiv.innerHTML = `
        <input type="text" placeholder="プレイヤー${i + 1}" value="プレイヤー${i + 1}" id="name${i}" />
        <p><input type="number" id="score${i}" value="25000" /></p>
        <div class="score-controls">
          <button onclick="adjustScore(${i}, 1000)">+1000</button>
          <button onclick="adjustScore(${i}, -1000)">-1000</button>
          <button onclick="adjustScore(${i}, 100)">+100</button>
          <button onclick="adjustScore(${i}, -100)">-100</button>
        </div>
      `;
      playerContainer.appendChild(playerDiv);
    }

    let supply = 0;
    function addSupply() {
      supply += 1000;
      document.getElementById('supply').textContent = supply;
    }
    function subSupply() {
      if(supply >= 1000) supply -= 1000;
      document.getElementById('supply').textContent = supply;
    }

    function adjustScore(index, amount) {
      const input = document.getElementById(`score${index}`);
      input.value = parseInt(input.value) + amount;
    }

    function recordLog() {
      const names = [], scores = [];
      let total = supply;
      for (let i = 0; i < playerCount; i++) {
        const name = document.getElementById(`name${i}`).value;
        const score = parseInt(document.getElementById(`score${i}`).value);
        if (isNaN(score)) return alert("点数が正しく入力されていません");
        names.push(name);
        scores.push(score);
        total += score;
      }

      if (total !== 100000) {
        alert("合計点が100000点ではありません（現在: " + total + "点）");
        return;
      }

      const timestamp = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
      logData.unshift({ names: [...names], scores: [...scores], supply: supply, time: timestamp });
      renderLog();
    }

    function renderLog() {
      const tbody = document.querySelector('#log tbody');
      tbody.innerHTML = '';

      if (logData.length === 0) return;

      // 時刻行
      const timeRow = document.createElement('tr');
      const timeLabel = document.createElement('td');
      timeLabel.textContent = '記録時間';
      timeRow.appendChild(timeLabel);
      logData.forEach((log, logIndex) => {
        const cell = document.createElement('td');
        cell.textContent = log.time;
        cell.classList.add('clickable');
        cell.onclick = () => restoreLog(logIndex);
        timeRow.appendChild(cell);
      });
      tbody.appendChild(timeRow);

      // 点数行（プレイヤーごとに1行）
      for (let i = 0; i < playerCount; i++) {
        const row = document.createElement('tr');
        const playerNameCell = document.createElement('td');
        playerNameCell.textContent = logData[0].names[i]; // 最新の名前表示
        row.appendChild(playerNameCell);

        logData.forEach(log => {
          const cell = document.createElement('td');
          cell.textContent = log.scores[i];
          row.appendChild(cell);
        });

        tbody.appendChild(row);
      }

      // 供託行
      const supplyRow = document.createElement('tr');
      const supplyLabel = document.createElement('td');
      supplyLabel.textContent = '供託';
      supplyRow.appendChild(supplyLabel);

      logData.forEach(log => {
        const cell = document.createElement('td');
        cell.textContent = log.supply;
        supplyRow.appendChild(cell);
      });
      
      tbody.appendChild(supplyRow);
    }

    function restoreLog(index) {
      if (!confirm("本当にこの記録に戻しますか？")) return;
      const log = logData[index];
      for (let i = 0; i < playerCount; i++) {
        document.getElementById(`score${i}`).value = log.scores[i];
        document.getElementById(`name${i}`).value = log.names[i];
      }
      supply = log.supply;
      document.getElementById('supply').textContent = supply;

      logData.splice(0, index);

      renderLog();
    }

    function resetScores() {
      if (!confirm("本当にリセットしますか？")){
        return;
      }
      for (let i = 0; i < playerCount; i++) {
        document.getElementById(`score${i}`).value = 25000;
        document.getElementById(`name${i}`).value = defaultNames[i];
      }
      supply = 0;
      document.getElementById('supply').textContent = supply;
      logData.length = 0;
      renderLog();
    }
  </script>
</body>
</html>
